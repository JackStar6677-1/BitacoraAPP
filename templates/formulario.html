<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Bitácora de Sala de Computación</title>
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='imagenes/logo.jpg') }}" type="image/jpeg">

    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* Body y layout */
        body {
            background-color: #2c2a63; /* azul-morado del logo */
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            position: relative;
            overflow-y: auto;
        }

        /* Logo fijo en esquina superior izquierda */
        .logo-corner {
            position: fixed;
            top: 15px;
            left: 15px;
            width: 70px;
            height: auto;
            z-index: 1050;
            filter: drop-shadow(0 0 2px rgba(0,0,0,0.6));
        }

        /* Container formulario con animacion de brillo */
        .form-container {
            background-color: white;
            color: #2c2a63; /* texto azul-morado */
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow:
                0 0 15px 3px rgba(44, 42, 99, 0.5),
                0 0 30px 5px rgba(44, 42, 99, 0.7);
            max-width: 480px;
            width: 100%;
            overflow-wrap: break-word;
            animation: glow 3s ease-in-out infinite alternate;
        }

        @keyframes glow {
            0% {
                box-shadow:
                    0 0 10px 2px rgba(44, 42, 99, 0.4),
                    0 0 20px 4px rgba(44, 42, 99, 0.6);
            }
            100% {
                box-shadow:
                    0 0 20px 4px rgba(44, 42, 99, 0.7),
                    0 0 40px 8px rgba(44, 42, 99, 0.9);
            }
        }

        /* Título */
        h1 {
            color: #2c2a63;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            word-wrap: break-word;
            font-size: 1.8rem;
            user-select: none;
            text-shadow: 0 0 3px rgba(44,42,99,0.8);
        }

        /* Labels */
        label {
            font-weight: 600;
        }

        /* Inputs y textarea con efecto focus */
        input.form-control, textarea.form-control {
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            border: 2px solid #ccc;
            border-radius: 6px;
        }
        input.form-control:focus, textarea.form-control:focus {
            border-color: #2c2a63;
            box-shadow: 0 0 8px 2px rgba(44, 42, 99, 0.6);
            outline: none;
        }

        /* Botones */
        .btn-primary {
            background-color: #2c2a63;
            border-color: #2c2a63;
            font-weight: 600;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 8px rgba(44, 42, 99, 0.5);
        }
        .btn-primary:hover {
            background-color: #241f52;
            border-color: #241f52;
            box-shadow: 0 0 15px rgba(44, 42, 99, 0.9);
        }
        .btn-link {
            color: #d63447; /* rojo del logo */
            font-weight: 600;
        }
        .btn-link:hover {
            color: #a02a38;
            text-decoration: none;
        }

        /* Alertas */
        .alert-info {
            background-color: #d9edf7;
            color: #31708f;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        /* Responsividad pequeña */
        @media (max-width: 520px) {
            .form-container {
                padding: 20px;
                max-width: 100%;
                border-radius: 10px;
                box-shadow: 0 0 12px rgba(44,42,99,0.6);
                animation: none;
            }
            h1 {
                font-size: 1.5rem;
                letter-spacing: 1px;
            }
        }
    </style>
</head>
<body>
    <!-- Logo en esquina -->
    <img src="{{ url_for('static', filename='imagenes/logo.jpg') }}" alt="Logo Colegio" class="logo-corner" />

    <div class="form-container shadow-sm">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">Nuevo Registro</h1>
            <div class="dropdown">
                <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <i class="fas fa-user"></i> {{ correo }}
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="{{ url_for('admin') }}"><i class="fas fa-list"></i> Ver Registros</a></li>
                    <li><a class="dropdown-item" href="{{ url_for('buscar') }}"><i class="fas fa-search"></i> Buscar</a></li>
                    <li><a class="dropdown-item" href="{{ url_for('gestionar_correos') }}"><i class="fas fa-envelope"></i> Gestionar Correos</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a></li>
                </ul>
            </div>
        </div>

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="alert alert-info" role="alert">
              {% for message in messages %}
                <p class="mb-0">{{ message }}</p>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <form method="POST" novalidate>
            <div class="mb-3">
                <label for="fecha" class="form-label">Fecha:</label>
                <input type="date" class="form-control" id="fecha" name="fecha" required />
            </div>
            <div class="mb-3">
                <label for="curso" class="form-label">Curso:</label>
                <input type="text" class="form-control" id="curso" name="curso" required placeholder="Ej: 7°A" />
            </div>
            <div class="mb-3">
                <label for="asignatura" class="form-label">Asignatura:</label>
                <input type="text" class="form-control" id="asignatura" name="asignatura" required placeholder="Ej: Matemática" />
            </div>
            <div class="mb-3">
                <label for="objetivo" class="form-label">Objetivo:</label>
                <textarea class="form-control" id="objetivo" name="objetivo" rows="3" placeholder="Describe el objetivo de la sesión" required></textarea>
            </div>
            <div class="mb-3">
                <label for="recursos" class="form-label">Actividad:</label>
                <textarea class="form-control" id="recursos" name="recursos" rows="2" placeholder="Ej: Creación de cuento, investigacion para proyecto, etc" required></textarea>
            </div>
            <div class="mb-3">
                <label for="observaciones" class="form-label">Observaciones:</label>
                <textarea class="form-control" id="observaciones" name="observaciones" rows="2" placeholder="Ej: PC08 no enciende" required></textarea>
            </div>
            <div class="mb-3">
                <label for="destinatario" class="form-label">Correos Destinatarios:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="destinatario" name="destinatario" 
                           placeholder="correo1@ejemplo.com, correo2@ejemplo.com" required>
                    <button class="btn btn-outline-secondary" type="button" id="btnCorreosPredeterminados">
                        <i class="fas fa-list"></i> Correos Predeterminados
                    </button>
                </div>
                <div class="form-text">
                    <strong>Correos disponibles:</strong>
                    <div id="correosDisponibles" class="mt-2">
                        {% for correo in correos_predeterminados %}
                        <span class="badge bg-primary me-1 mb-1 correo-badge" style="cursor: pointer;" 
                              onclick="agregarCorreo('{{ correo }}')" title="Hacer clic para agregar">
                            {{ correo }} <i class="fas fa-plus"></i>
                        </span>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-save"></i> Guardar y Enviar
            </button>
        </form>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Establecer fecha actual por defecto
        document.addEventListener('DOMContentLoaded', function() {
            const fechaInput = document.getElementById('fecha');
            const today = new Date().toISOString().split('T')[0];
            fechaInput.value = today;
        });

        // Función para agregar correos predeterminados
        function agregarCorreo(correo) {
            const inputDestinatario = document.getElementById('destinatario');
            const valorActual = inputDestinatario.value.trim();
            
            if (valorActual === '') {
                inputDestinatario.value = correo;
            } else {
                // Verificar si el correo ya está en la lista
                const correosExistentes = valorActual.split(',').map(c => c.trim());
                if (!correosExistentes.includes(correo)) {
                    inputDestinatario.value = valorActual + ', ' + correo;
                }
            }
            
            // Efecto visual
            const badge = event.target.closest('.correo-badge');
            badge.style.transform = 'scale(0.95)';
            setTimeout(() => {
                badge.style.transform = 'scale(1)';
            }, 150);
        }

        // Función para agregar todos los correos predeterminados
        document.getElementById('btnCorreosPredeterminados').addEventListener('click', function() {
            const correos = [];
            document.querySelectorAll('.correo-badge').forEach(badge => {
                const correo = badge.textContent.replace(' +', '').trim();
                correos.push(correo);
            });
            
            const inputDestinatario = document.getElementById('destinatario');
            inputDestinatario.value = correos.join(', ');
            
            // Efecto visual
            this.style.backgroundColor = '#28a745';
            this.style.borderColor = '#28a745';
            this.style.color = 'white';
            setTimeout(() => {
                this.style.backgroundColor = '';
                this.style.borderColor = '';
                this.style.color = '';
            }, 1000);
        });
    </script>
</body>
</html>
